import{t as L,a as H}from"./transactions.module.uFFnM2s4.js";import{b as G,a as k}from"./accounts.module.CLXOAEk-.js";import"./notificiation.BI0G4Md-.js";import"./index.BXL97NTB.js";import"./index.CViUNx8d.js";const R=document.getElementById("filter-modal-btn"),V=document.getElementById("filters-container"),$=document.getElementById("filter-result"),w=document.getElementById("transaction-list-body-table"),N=document.getElementById("transaction-list-body-cards"),M=document.getElementById("filter-description"),O=document.getElementById("filter-date"),_=document.getElementById("filter-type"),B=document.getElementById("filter-account"),j=document.getElementById("transaction-item-template-table"),z=document.getElementById("transaction-item-template-card");let A=[],g=[];const J=a=>{if(w.innerHTML="",N.innerHTML="",a.length===0){w.innerHTML='<tr><td colspan="6" class="p-4 text-center text-gray-500">No se encontraron transacciones.</td></tr>',N.innerHTML='<div class="p-4 text-center text-gray-500">No se encontraron transacciones.</div>';return}a.forEach(t=>{const u=t.type==="income"?"Ingreso":"Gasto",p=t.type==="income"?"text-green-600":"text-red-600",e=j.content.cloneNode(!0);e.id=t.id,e.querySelector('input[data-field="description"]').value=t.description,e.querySelector('input[data-field="date"]').value=t.date.split("T")[0],e.querySelector('span[data-field="type"]').textContent=u,e.querySelector('span[data-field="type"]').classList.add(p),e.querySelector('input[data-field="amount"]').value=t.amount,e.querySelector('span[data-field="accountName"]').textContent=t.account_name,e.querySelector('span[data-field="accountName"]').dataset.accountId=t.accountId,w.appendChild(e);const i=z.content.cloneNode(!0).firstElementChild;i.id=t.id,i.querySelector('[data-field="description"]').textContent=t.description,i.querySelector('[data-field="date"]').textContent=t.date.split("T")[0],i.querySelector('[data-field="type"]').textContent=u,i.querySelector('[data-field="amount"]').textContent=t.amount,i.querySelector('[data-field="accountName"]').textContent=t.account_name,i.querySelector('[data-field="amount-container"]').classList.add(t.type==="income"?"bg-green-100":"bg-red-100",t.type==="income"?"text-green-800":"text-red-800"),N.appendChild(i)})},x=()=>{let a=A;const t=M.value.toLowerCase(),u=O.value,p=_.value,e=B.value;t&&(a=a.filter(S=>S.description.toLowerCase().includes(t))),u&&(a=a.filter(S=>S.date.split("T")[0]===u)),p&&(a=a.filter(S=>S.type===p)),e&&(a=a.filter(S=>String(S.account_id)===String(e))),J(a);const i=a.length;$.textContent=`Se encontraron ${i} transacciÃ³n(es).`},K=[w,N];K.forEach(a=>{a.addEventListener("click",async t=>{const u=t.target.closest(".delete-btn"),p=t.target.closest(".edit-btn");if(u){const e=u.closest("tr")||u.closest(".bg-white");if(e){const i=e.id;await L.removeTransaction(i)}}if(p){const e=p.closest("tr")||p.closest(".bg-white");if(e){const i=e.id;if(e.classList.contains("bg-white")){const b=e.querySelector('[data-field="description"]'),I=e.querySelector('[data-field="date"]'),E=e.querySelector('[data-field="type"]'),C=e.querySelector('[data-field="amount"]'),q=e.querySelector('[data-field="accountName"]'),v=p.children[1],T=p.children[0];if(b.tagName==="DIV"){const m=A.find(s=>String(s.id)===i),f=document.createElement("input");f.type="text",f.value=m.description,f.className="w-full bg-transparent border-0 p-0 m-0 focus:outline-none",f.setAttribute("data-field","description");const n=document.createElement("input");n.type="date",n.value=m.date.split("T")[0],n.className="w-full bg-transparent border-0 p-0 m-0 focus:outline-none",n.setAttribute("data-field","date");const o=document.createElement("select");o.className="w-full bg-transparent border-0 p-0 m-0 focus:outline-none",o.setAttribute("data-field","type");const r=document.createElement("option");r.value="income",r.textContent="Ingreso",o.appendChild(r);const l=document.createElement("option");l.value="expense",l.textContent="Gasto",o.appendChild(l),o.value=m.type;const c=document.createElement("input");c.type="number",c.value=m.amount,c.className="w-full bg-transparent border-0 p-0 m-0 focus:outline-none",c.setAttribute("data-field","amount");const d=document.createElement("select");d.className="w-full bg-transparent border-0 p-0 m-0 focus:outline-none",d.setAttribute("data-field","accountName"),g.forEach(s=>{const y=document.createElement("option");y.value=s.id,y.textContent=s.name,d.appendChild(y)}),d.value=m.account_id,b.replaceWith(f),I.replaceWith(n),E.replaceWith(o),C.replaceWith(c),q.replaceWith(d),T.classList.add("hidden"),v.classList.remove("hidden")}else{const m=e.querySelector('input[data-field="description"]'),f=e.querySelector('input[data-field="date"]'),n=e.querySelector('select[data-field="type"]'),o=e.querySelector('input[data-field="amount"]'),r=e.querySelector('select[data-field="accountName"]'),l=document.createElement("div");l.className="font-bold text-lg text-gray-900",l.setAttribute("data-field","description"),l.textContent=m.value;const c=document.createElement("div");c.className="text-sm text-gray-500",c.setAttribute("data-field","date"),c.textContent=f.value;const d=document.createElement("span");d.setAttribute("data-field","type"),d.textContent=n.options[n.selectedIndex].textContent;const s=document.createElement("span");s.setAttribute("data-field","amount"),s.textContent=o.value;const y=document.createElement("span");y.setAttribute("data-field","accountName"),y.textContent=r.options[r.selectedIndex].textContent,m.replaceWith(l),f.replaceWith(c),n.replaceWith(d),o.replaceWith(s),r.replaceWith(y),T.classList.remove("hidden"),v.classList.add("hidden");const h=Number(r.value),W=g.find(F=>F.id===h),D={id:i,description:m.value,date:new Date(f.value).toISOString(),amount:Number(o.value),type:n.value,accountId:h,account_name:W.name};await L.updateTransaction(D)}}else{const b=e.querySelector('input[data-field="description"]'),I=e.querySelector('input[data-field="date"]'),E=e.querySelector('input[data-field="amount"]'),C=e.querySelector('[data-field="type-container"]'),q=C.querySelector('[data-field="type"]'),v=e.querySelector('[data-field="accountName-container"]'),T=v.querySelector('[data-field="accountName"]'),m=p.children[1],f=p.children[0];if(b.hasAttribute("readonly")){b.removeAttribute("readonly"),I.removeAttribute("readonly"),E.removeAttribute("readonly");const n=document.createElement("select");n.className="w-full bg-transparent border-0 p-0 m-0 focus:outline-none",n.setAttribute("data-field","type-select");const o=document.createElement("option");o.value="income",o.textContent="Ingreso",n.appendChild(o);const r=document.createElement("option");r.value="expense",r.textContent="Gasto",n.appendChild(r),q.textContent==="Ingreso"?n.value="income":n.value="expense",C.replaceChild(n,q);const l=document.createElement("select");l.className="w-full bg-transparent border-0 p-0 m-0 focus:outline-none",l.setAttribute("data-field","account-select"),g.forEach(d=>{const s=document.createElement("option");s.value=d.id,s.textContent=d.name,l.appendChild(s)});const c=A.find(d=>String(d.id)===i);c&&(l.value=String(c.account_id)),v.replaceChild(l,T),f.classList.add("hidden"),m.classList.remove("hidden")}else{b.setAttribute("readonly",!0),I.setAttribute("readonly",!0),E.setAttribute("readonly",!0);const n=C.querySelector('[data-field="type-select"]'),o=v.querySelector('[data-field="account-select"]'),r=n.value,l=r==="income"?"Ingreso":"Gasto",c=document.createElement("span");c.setAttribute("data-field","type"),c.textContent=l,c.classList.add(r==="income"?"text-green-600":"text-red-600"),C.replaceChild(c,n);const d=Number(o.value),s=g.find(D=>D.id===d),y=s?s.name:"Cuenta no encontrada",h=document.createElement("span");h.setAttribute("data-field","accountName"),h.textContent=y,v.replaceChild(h,o),!o.value&&g.length>0&&(o.value=String(g[0].id)),f.classList.remove("hidden"),m.classList.add("hidden");const W={id:i,description:b.value,date:new Date(I.value).toISOString(),amount:Number(E.value),type:r,accountId:d,account_name:y};await L.updateTransaction(W)}}}}})});R.addEventListener("click",()=>{V.classList.toggle("hidden")});H.subscribe(a=>{A=a,g.length>0&&x()});G.subscribe(a=>{g=a,B.innerHTML='<option value="">Todas</option>';for(const t of a){const u=document.createElement("option");u.value=t.id,u.textContent=t.name,B.appendChild(u)}A.length>0&&x()});document.addEventListener("DOMContentLoaded",()=>{M.addEventListener("input",x),O.addEventListener("change",x),_.addEventListener("change",x),B.addEventListener("change",x)});(async()=>(await k.getAccount(),await L.getTransaction()))();
